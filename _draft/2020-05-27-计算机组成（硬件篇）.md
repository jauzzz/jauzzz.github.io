---
layout: post
title: "计算机组成"
subtitle: "硬件篇"
modified: 2020-05-27 15:22:09 +0800
tags: []
image:
  feature: 
  credit: 
  creditlink: 
comments: 
share: 
disqus: 
mathjax: y


---



本文将介绍一个基本的计算机硬件组成



## 图灵机

我们知道，计算机是一个提供*计算*和*存储*能力的机器，是对人计算过程的模拟，是计算模型的实践.

计算模型有很多种：

- [图灵机](https://zh.wikipedia.org/wiki/图灵机)
- [λ演算](https://zh.wikipedia.org/wiki/Λ演算)
- [寄存器](https://zh.wikipedia.org/wiki/寄存器机)
- [递归函数](https://zh.wikipedia.org/wiki/递归函数)

图灵机是其中一个理论模型，本质上是[状态机](https://zh.wikipedia.org/wiki/有限状态机).



图灵机的基本思想是模拟人类数学运算的过程，从中提取出以下两种动作：

1. 在纸上写或擦除某个符号
2. 把注意力从纸上的一个位置移动到另一个位置

![图灵机结构](https://tva1.sinaimg.cn/large/006y8mN6gy1g800q01y4kj30dw06a3yj.jpg)



根据这个模型，图灵设想了一台机器，由以下几部分组成：

- **无限长纸带**，纸带分成一个个的格子
- **读写头**，可以在纸带上移动，并且读写当前格子上的符号
- **规则表**，根据机器状态和当前格子上的符号确定下一步读写头的动作，并相应改变状态寄存器的值
- **状态寄存器**，用于保存当前机器的状态

这个机器的各部分都是有限的，但有一个无限长纸带，因此是一个理想设备.



在任意时刻，它都会根据 `当前状态 + 规则`，决定下一步操作：

1. 读纸带
2. 寻找对应的转移规则
3. 找到规则，执行
4. 向纸带上写回数据
5. 更新状态
6. 读写头向左或向右移动



## CPU

> CPU 是图灵机的一个电气实现，但图灵机不一定要由电路组成



这里需要介绍一下时序逻辑电路

[时序逻辑电路](https://zh.wikipedia.org/wiki/%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91%E7%94%B5%E8%B7%AF)是指电路任何时刻的稳态输出不仅取决于当前的输入，还与前一时刻输入形成的状态有关。

这个特性，与图灵机的特性非常相似，所以我们可以根据图灵机的性质来设计一个时序电路，称为 `CPU`。事实上，第一个把计算和电子元件联系起来的人是香农，他在论文《对继电器和开关电路中的符号分析》中首次提出通过电器元件来进行数学计算，并证明了可以通过继电器电路来实现布尔代数的逻辑运算。



现代CPU的执行流程是：

1. 取指（fetch）
2. 译码（decode）
3. 执行（execute）
4. 访存（memory）
5. 写回（write back）
6. 更新PC（PC update）

可以发现，与图灵机的步骤一一对应：

| CPU    | 图灵机                         |
| :----- | :----------------------------- |
| 取指   | 读纸带                         |
| 译码   | 寻找对应的转移规则             |
| 执行   | 找到规则，执行                 |
| 访存   | 向纸带上写回数据               |
| 写回   | （同上）                       |
| 更新PC | 更新状态，读写头向左或向右移动 |



## 冯诺依曼体系结构

我们知道，图灵机是一个理想的模型，它假设有无限长的纸带和一套规则表。

冯诺依曼体系架构，是图灵机的一个物理模型，主要有以下不同：

- 替代无限长纸带，由存储器来提供（有限）存储能力
  存储器的电气单元是触发器
- 将规则表内置在计算机（存储器）中
  由于存储器的内容可以变更，所以该设计意味着计算机可以改变自己的规则
- 程序和数据都以二进制表示

<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf6bkfwldrj30jq0aj3yv.jpg" alt="img" style="zoom:67%;" />



在该体系结构中，所有的指令和数据都要由存储器传递至CPU；
同时指令和数据共用一条总线（存储器和CPU之间的通路），导致取指和取数据不能同时进行，否则会引起访存混乱；
而CPU的处理速度远远大于访存速度，因此CPU必须浪费时间等待数据。

**由于指令与数据放在同一内存带来的CPU利用率（吞吐率）限制就是冯诺依曼瓶颈**



## 硬件组成与内存地址空间

按照冯诺依曼体系结构，有三大基础部件：CPU、存储器、输入输出；

这些部件是相互独立的，只有将他们连接起来，才能开始工作。



#### 存储器和存储系统

一个存储单元，通常可以存储一个字节，称为一个比特（Byte）

> 1 Byte = 8 bit = 8 个二进制位（一个二进制位，就是一个 0/1）



而计算机的存储器是由若干个存储单元组成的，这些存储单元按顺序编号

![未命名文件](https://tva1.sinaimg.cn/large/007S8ZIlgy1ge19bcfv2uj308g044a9w.jpg)



通过不同的存储器组合，构成了计算机的存储系统

![img](https://tva1.sinaimg.cn/large/007S8ZIlgy1gf6shud64qj30k005eweo.jpg)



#### 主板与接口卡

主板上，有一些核心器件和主要器件，这些器件通过总线（地址总线、数据总线、控制总线）相连。

这些器件有：CPU、存储器、外围芯片组、扩展插槽（一般插有：RAM内存条、各类接口卡）等



计算机系统中，所有可用程序控制其工作的设备，都必须收到CPU控制。

当然，CPU是不能直接控制他们的，能直接控制设备进行工作的，是插在扩展插槽的接口卡，但是CPU可以通过总线向接口卡发送命令，从而间接控制设备。



#### 内存地址空间

在计算机中，所有的物理存储器都被看作一个由若干存储单元组成的逻辑存储器，每个物理存储器占有逻辑存储器的部分地址空间。CPU 就在这段地址空间内进行读写数据，在不同的段读写就是在不同的存储器读写。

<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gf6u1pzu32j30nj0kztiu.jpg" alt="image-20200527111036924" style="zoom:67%;" />



#### 端口地址空间

所有的接口卡，都有一组可以由 CPU 直接读写的寄存器，这些寄存器都通过总线与 CPU 相连；

于是，CPU 将这些寄存器统一编址，并建立了一个端口地址空间。



#### 概述

计算机的硬件之间，通过总线相连，同时由于工艺集成的需要，统一插在主板上；

计算机的内存地址空间，是一个逻辑地址空间，映射了许多物理存储器；

计算机的端口地址空间，映射了许多外部设备，是CPU控制外设的桥梁。



## 内存读写

CPU 是通过总线向内存（内存地址空间）读写数据的。

任意的一个读写行为，存在三个信息：`行为（读/写） + 数据 + 地址`

对应的，也有三条总线：

- 地址总线 - 该线的宽度，决定了CPU的寻址能力，也就是能够访问到多少内存单元
- 数据总线 - CPU和存储器进行数据传输的硬件通道，宽度有多少，就能够一次性传输多少位的信息
- 控制总线



<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf6s5a4ku1j30hn0fzdgf.jpg" alt="image-20200527100447123" style="zoom: 67%;" />



## 总结

至此，就是一个完整的计算机组成了。

我们对照一下图灵机的组成：

- 无限长纸带 <--> 内存地址空间
- 读写头 <--> 可以通过总线读取内存
- 规则表 <--> 存储在内存
- 寄存器 <--> CPU 自己有寄存器



至此，只要给了计算机第一条指令，CPU就可以一直执行下去（直至没有指令）。

而第一条指令是如何获取的，则是由计算机的开机过程进行初始化。



## Reference

- [What is a Turing machine?](https://www.cl.cam.ac.uk/projects/raspberrypi/tutorials/turing-machine/one.html#one-four)

- [计算机的计算](https://www.nosuchfield.com/2017/01/05/Computation-of-computers/)
- [触发器]([https://baike.baidu.com/item/%E8%A7%A6%E5%8F%91%E5%99%A8/193146#viewPageContent](https://baike.baidu.com/item/触发器/193146#viewPageContent))
- [电路为什么要有触发器这种结构？](https://www.zhihu.com/question/35128735)
- [性能之殇：从冯·诺依曼瓶颈谈起](https://www.jiqizhixin.com/articles/2018-12-18-11)

